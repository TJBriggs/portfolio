/*------------------------------------*\
    ::Ajax In Images
    ----------------------------------*
    https://snippetlib.com/jquery/replace_all_svg_images_with_inline_svg
\*------------------------------------*/
// Using this script to convert icons from an image to an svg on load 
// this just allows me to load the SVG's via an image tag rather than 
// Large blocks of SVG code.
var ajaxReplace = function() {
    // find all img tags in need of changing to svg
    $('.js-ajax-replace').each(function(){
        // cache this image
        var $img = $(this);
        // capture it's classes
        var classes = $img.attr('class');
        // grab the svg via ajax
        $.get($img.attr('src'), function(data) {
            // find just the svg from what's retrieved
            var svg = $(data).find('svg');
            svg
                // reapply the classes
                .attr('class', classes)
                // remove inline style tags from svg's
                .find('style')
                    .remove()
                    .end()
                // remove fill on this and all children
                .attr('fill','')
                .find('*')
                    .attr('fill','');
            // replace the img with the svg
            $img.replaceWith(svg);
        });
    });
};
$(document).ready(function() {
    ajaxReplace();
});

/*------------------------------------------*\
    :: Open video in Fancybox
\*------------------------------------------*/
var fancyFancy = function () {
    $('.fancybox-media').fancybox({
        openEffect  : 'none',
        closeEffect : 'none',
        helpers : {
            media : {}
        }
    });
};
$(document).ready(function() {
    if ($.isFunction($.fn.fancybox)) { // Check to see if fancybox function is on current page
    fancyFancy();
    }
});
/*------------------------------------*\
    ::  Navigation Functionality
\*------------------------------------*/	
var clickable = function($el, stopProp){
    stopProp = stopProp || false;
    // stop link propogation
    if(stopProp){
        $el.find('a').click(function(e){
            e.stopPropagation();
        });
    }
    // expand sub menu
    $el.click(function(){
        $el.not(this).removeClass('active');
        $(this).toggleClass('active');
    });
};
jQuery(function($){
    var trigger = $('#js-nav-trigger');
    clickable(
        $('#menu-main').find('.menu-item-has-children'),
        true
    );
    clickable(trigger);
    trigger.on("click", function(){
        var $bod = $('body');
        $('main-head__trigger').toggleClass('active');
        if(!$bod.hasClass('active')) {
            // set width to the width _before_ adding overflow:hidden
            $('body, html').toggleClass('locked');
            // change menu text to close
            $('.main-head__trigger span').text('Close');

        } else {
            // make flexible again
           $('body, html').toggleClass('locked');
            // change close back to menu
            $('.main-head__trigger span').text('Menu');
        }
        $bod.toggleClass('active');
    });
    /*------------------------------------*\
    ::Sticky Header
    \*------------------------------------*/
    var didScroll;
    var lastScrollTop = 0;
    var delta = 1;
    var navbarHeight = 1;
    $(window).scroll(function(event){
        didScroll = true;
    });
    setInterval(function() {
        if (didScroll) {
            hasScrolled();
            didScroll = false;
        }
    }, 250);
    function hasScrolled() {
        //var $mNav = $('.main-head__trigger');
        if(!trigger.hasClass('active')) { // if the nav is open don't shrink header
            var st = $(this).scrollTop();
            // Make sure they scroll more than delta
            if(Math.abs(lastScrollTop - st) <= delta)
                return;
            // If they scrolled down and are past the navbar, add class .nav-up.
            // This is necessary so you never see what is "behind" the navbar.
            if (st > lastScrollTop && st > navbarHeight){
                // Scroll Down
                $('body').addClass('scrollin');
                $('.main-head--original').removeClass('main-head--normal').addClass('main-head--sticky');
            } else if(st == 0) {
                    $('body').removeClass('scrollin');
                    $('.main-head--original').removeClass('main-head--sticky').addClass('main-head--normal');
            }
            lastScrollTop = st;
        }
    }
});
/*------------------------------------*\
    :: Way Point Animation Effects
\*------------------------------------*/
/*------------------------------------*\
    ::  Icon Callouts Waypoint
\*------------------------------------*/   
var iconCallouts = function () {
    var $section = $('.icon-callouts');
    // Remove visible class on page load so that it can animate in
    // If JS is off, images will automatically appear
    $section.removeClass('visible');
    $section.waypoint(function(){  
        $(this).addClass('visible');
    }, { offset: '50%' });
};
/*------------------------------------*\
  :: Centered CTA Waypoint  
\*------------------------------------*/    
var centeredCTA = function () {
    var $section = $('.centered-cta');
    var $wrap = $('.centered-cta__wrap');
    // Remove visible class on page load so that it can animate in
    // If JS is off, images will automatically appear
    $section.removeClass('visible');
    $wrap.removeClass('visible');
    $section.waypoint(function(){  
        $(this).addClass('visible');
        $wrap.addClass('visible');
    }, { offset: '50%' });
};
/*------------------------------------*\
  :: Column Callout Waypoint  
\*------------------------------------*/    
var columnCallout = function () {
    var $section = $('.column-callout');
    // Remove visible class on page load so that it can animate in
    // If JS is off, images will automatically appear
    $section.removeClass('visible');
    $section.waypoint(function(){  
        $section.addClass('visible');
    }, { offset: '50%' });
};
/*------------------------------------*\
  :: Coaches Block 
\*------------------------------------*/    
var coachesBlock = function () {
    var $section = $('.coaches-block');
    // Remove visible class on page load so that it can animate in
    // If JS is off, images will automatically appear
    $section.removeClass('visible');
    $section.waypoint(function(){  
        $section.addClass('visible');
    }, { offset: '50%' });
};
$(document).ready(function() {
    if ($.isFunction($.fn.waypoint)) { // Check to see if waypoint function is on current page
        iconCallouts();
        centeredCTA();
        columnCallout();
        coachesBlock();
    }
});
